{% extends 'base.html.twig' %}
{% import '@App/theme1/breadcrumb.html.twig' as breadcrumb %}

{% set _title = 'Paciente' %}
{% set _main_title = 'Nuevo' %}
{% set _section =  'paciente_index'%}

{% block _breadcrumb %}
    {{ breadcrumb.show2(_title,_section,'Nuevo') }}
{% endblock %}

{% block _main %}
    {{ include('paciente/_form.html.twig') }}
{% endblock %}

{% block _body_tools %}
    {% include 'crud/_new_links_ico.html.twig' with {'route_base':'paciente'} %}
{% endblock %}

{% block _main_footer %}
    {% include 'crud/_new_links.html.twig' with {'route_base':'paciente'} %}
{% endblock %}

{% block stylesheets %}
{% endblock %}

{% block javascripts %}
    <script src="{{ asset('js/select2.js') }}"></script>
    <script src="{{ asset('js/flatpickr.js') }}"></script>
    <script>
        let dniTxt = document.getElementById('paciente_dni');
        let nombresTxt = document.getElementById('paciente_nombres');
        let apPaternoTxt = document.getElementById('paciente_apellidoPaterno');
        let apMaternoTxt = document.getElementById('paciente_apellidoMaterno');
    </script>
    <script>
        async function getPersonaApi(dni) {
            let response = await fetch('{{ path('buscar_paciente_dni') }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    dni: dni,
                })
            });

            return await response.json();
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            Flatpickr()
            Select2()
        })

        dniTxt.onkeyup = function () {
            if(this.value.length === 8){
                getPersonaApi(this.value).then(result => {
                    if (null !== result.data) {
                        nombresTxt.value = result.data['nombres'];
                        apPaternoTxt.value = result.data['apellidoPaterno'];
                        apMaternoTxt.value = result.data['apellidoMaterno'];
                    }
                })
            }
        }
    </script>
{% endblock %}
